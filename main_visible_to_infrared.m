clear;
clc;
% 假设双光视频的FPS都相同
% infrared = [2.840000000000000000e+02,2.980000000000000000e+02,1.000000000000000000e+00
% 3.500000000000000000e+02,3.270000000000000000e+02,1.000000000000000000e+00
% 2.840000000000000000e+02,2.980000000000000000e+02,1.000000000000000000e+00
% 3.500000000000000000e+02,3.270000000000000000e+02,1.000000000000000000e+00
% 2.830000000000000000e+02,2.980000000000000000e+02,1.000000000000000000e+00
% 3.490000000000000000e+02,3.270000000000000000e+02,1.000000000000000000e+00
% 2.840000000000000000e+02,2.980000000000000000e+02,1.000000000000000000e+00
% 3.500000000000000000e+02,3.270000000000000000e+02,1.000000000000000000e+00
% 2.840000000000000000e+02,2.980000000000000000e+02,1.000000000000000000e+00
% 3.500000000000000000e+02,3.270000000000000000e+02,1.000000000000000000e+00]

% visible = [3.720000000000000000e+02,3.490000000000000000e+02,1.000000000000000000e+00
% 3.200000000000000000e+02,3.190000000000000000e+02,1.000000000000000000e+00
% 3.730000000000000000e+02,3.490000000000000000e+02,1.000000000000000000e+00
% 3.190000000000000000e+02,3.210000000000000000e+02,1.000000000000000000e+00
% 3.720000000000000000e+02,3.510000000000000000e+02,1.000000000000000000e+00
% 3.180000000000000000e+02,3.230000000000000000e+02,1.000000000000000000e+00
% 3.710000000000000000e+02,3.530000000000000000e+02,1.000000000000000000e+00
% 3.180000000000000000e+02,3.230000000000000000e+02,1.000000000000000000e+00
% 3.710000000000000000e+02,3.530000000000000000e+02,1.000000000000000000e+00
% 3.710000000000000000e+02,3.530000000000000000e+02,1.000000000000000000e+00 ]

%%  visible*fit_matrix=infrared
M = 5
infrared = infrared(1:M,:)'
visible = visible(1:1800,:)'

% visible_pinv = pinv(visible)  %  伪逆
% fit_matrix = visible_pinv*infrared
%%  https://blog.csdn.net/liuweiyuxiang/article/details/82799999
x_visible = visible(1,:)
y_visible = visible(2,:)
x_infrared = infrared(1,:)
y_infrared = infrared(2,:)

% c1= polyfit(x_visible,x_infrared,1)   % https://zhidao.baidu.com/question/1493947532374907499.html
% c2 = polyfit(y_visible,y_infrared,1)
% 
% Y = x_infrared
% X1 = x_visible
% X2 = y_visible
%  X =[ones(size(x_infrared)),X1,X2];   %  Y=a*X1+B*X2+c   X=[ones(size(Y)),X1,X2]
% [b,bint,r,rint,stats]=regress(Y',X,0.05)

%% https://www.www66444.com.cn/zuoye/5436909
% MATLAB 用regress函数的二元线性拟合函数 M=a+bx+cy a,b,c为参数 x,y为变量 假设一组数据 M=[ 234 237 239 280 290]x=[ 3.13 3.15 3.18 3.19 3.23]y=[ 87.5 89.6 94.5 99.5 104.6]
%% 拟合矩阵的第一个函数
M= x_infrared;
size_m = size(M)
x= x_visible;
y=y_visible;
X=[ones(size_m(2),size_m(1)) x' y'];
[B1,BINT,R,RINT,STATS] = regress(M',X);   % B1：c1, a1, b1

%%   拟合矩阵的第二个函数   https://blog.csdn.net/liuweiyuxiang/article/details/82799999
M= y_infrared;   
x= x_visible;
y=y_visible;
X=[ones(size_m(2),size_m(1)) x' y'];
[B2,BINT,R,RINT,STATS] = regress(M',X);    %  B2：c2, a2, b2

%  
% B = [0.803271838597598,0.00363813872899273,-354.141567587306;  %  a1, b1,c1
%      0.0158988245484757,0.791743191445523,-192.690752783920;   % a2,b2, ,c2
%      0 0 1]        
B = [B1';B2';1 0 0]
% BB = [B(:,2);B(:,3);B(:,1)]
BB(:,1) = B(:,2) 
BB(:,2) = B(:,3) 
BB(:,3) = B(:,1) 
matrix_affine_trans = BB


%% matrix_affine_trans样例
%     matrix_affine_trans = np.array([[  0.8521,    0.1045, -469.0305],
%                                     [ -0.0373,    0.8603, -235.4014],
%                                     [0, 0, 1]])
